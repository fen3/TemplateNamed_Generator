function genClassInfo(tableSql){tableSql=tableSql.trim().replace(/'/g,"`").replace(/\"/g,"`").replace(/，/g,",").toLowerCase();while(tableSql.includes("  ")){tableSql=tableSql.replace(/  /g," ")}var tableName=null;if(tableSql.includes("table")&&tableSql.includes("(")){var b=tableSql.indexOf("table")+5;var e=tableSql.indexOf("(");tableName=tableSql.substring(b,e)}else{alert("无表名，请检查语句。")}if(tableName.includes("if not exists")){tableName=tableName.replace("if not exists","")}if(tableName.includes("`")){tableName=tableName.substring(tableName.indexOf("`")+1,tableName.lastIndexOf("`"))}else{tableName=tableName.replace(" ","").replace("\n","").replace("\t","")}var className=tablename2ClassName(tableName);var classComment=tableName;if(tableSql.includes("comment=")){classComment=className;var classCommentTmp=tableSql.substring(tableSql.lastIndexOf("comment=")+8,tableSql.length).replace(/`/g,"").trim();if(classCommentTmp.indexOf(" ")!=classCommentTmp.lastIndexOf(" ")){classCommentTmp=classCommentTmp.substring(classCommentTmp.indexOf(" ")+1,classCommentTmp.lastIndexOf(" ")).trim()}if(classCommentTmp!=null&&classCommentTmp.trim().length>0){var classComment=classCommentTmp}}else{if(tableSql.includes("comment on table")){classCommentTmp=tableSql.substring(tableSql.lastIndexOf("comment on table")+17,tableSql.length).trim();if(classCommentTmp.includes("`")){classCommentTmp=classCommentTmp.substring(classCommentTmp.index("`")+1,classCommentTmp.length);classCommentTmp=classCommentTmp.substring(0,classCommentTmp.index("`"));classComment=classCommentTmp}}}classComment=classComment.replace(/;/g,"");var fieldList=[];var fieldListTmp=tableSql.substring(tableSql.indexOf("(")+1,tableSql.lastIndexOf(")"));var commentPattenStr1=/comment `(.*?)`/g;var matchers1=fieldListTmp.match(commentPattenStr1);for(var i=0,max=matchers1.length;i<max;i++){var cmt=matchers1[i];if(cmt.indexOf(",")){fieldListTmp=fieldListTmp.replace(cmt,cmt.replace(/,/g,"，"))}}commentPattenStr2=/`(.*?)`/g;matchers2=fieldListTmp.match(commentPattenStr2);for(var i=0,max=matchers2.length;i<max;i++){var cmt=matchers2[i];if(cmt.indexOf(",")){fieldListTmp=fieldListTmp.replace(cmt,cmt.replace(/,/g,"，"))}}fieldLineList=fieldListTmp.split(",");var primary_column=null;var i=0;var has_date=false;for(var idx=0,max=fieldLineList.length;idx<max;idx++){i++;columnLine=fieldLineList[idx];columnLine=columnLine.replace(/\n/g,"").replace(/\t/g,"").trim();specialFlag=(!columnLine.includes("key")&&!columnLine.includes("constraint")&&!columnLine.includes("using")&&!columnLine.includes("unique")&&!(columnLine.includes("primary")&&columnLine.indexOf("storage")+3>columnLine.indexOf("("))&&!columnLine.includes("pctincrease")&&!columnLine.includes("buffer_pool")&&!columnLine.includes("tablespace")&&!(columnLine.includes("primary")&&i>3));if(columnLine.includes("primary key ")){var leftidx=columnLine.indexOf("(");rightidx=columnLine.indexOf(")",leftidx);primary_column=columnLine.substring(leftidx,rightidx+1).replace(/\(`/g,"").replace(/`\)/g,"").trim()}if(specialFlag){if(columnLine.length<5){continue}columnLine=columnLine.replace(/`/g," ").replace(/\"/g," ").replace(/'/g,"").replace(/  /g," ").trim();columnName=columnLine.substring(0,columnLine.indexOf(" "));fieldName=underlineToCamelCase(columnName);if(fieldName.startsWith("Is")){fieldName="is"+fieldName.substring(2,fieldName.length)}columnLine=columnLine.substring(columnLine.indexOf("`")+1,columnLine.length).trim();var fieldClass="String";if(columnLine.includes(" tinyint")){fieldClass="boolean"}else{if(columnLine.includes(" int")||columnLine.includes(" smallint")){fieldClass="Integer"}else{if(columnLine.includes(" bigint")){fieldClass="Long"}else{if(columnLine.includes(" float")){fieldClass="Float"}else{if(columnLine.includes(" double")){fieldClass="Double"}else{if(columnLine.includes(" time")||columnLine.includes(" date")||columnLine.includes(" datetime")||columnLine.includes(" timestamp")){fieldClass="Date";has_date=true}else{if(columnLine.includes(" varchar")||columnLine.includes(" text")||columnLine.includes(" char")||columnLine.includes(" clob")||columnLine.includes(" blob")||columnLine.includes(" json")){fieldClass="String"}else{if(columnLine.includes(" boolean")){fieldClass="boolean"}else{if(columnLine.includes(" decimal")||columnLine.includes(" number")){var startKh=columnLine.indexOf("(");if(startKh>=0){var endKh=columnLine.indexOf(")",startKh);var fanwei=columnLine.substring(startKh+1,endKh).split("，");if((fanwei.length>1&&"0"==fanwei[0])||fanwei.length==1){var llll=Number(fanwei[0]);if(fanwei.length>1){llll=Number(fanwei[1])}if(llll<=9){fieldClass="Integer"}else{fieldClass="Long"}}else{fieldClass="BigDecimal"}}else{fieldClass="BigDecimal"}}else{fieldClass="String"}}}}}}}}}var fieldComment=columnName;if(tableSql.includes("comment on column")&&(tableSql.includes("."+columnName+" is ")||tableSql.includes(".`"+columnName+"` is"))){tableSql=tableSql.replace(".`"+columnName+"` is","."+columnName+" is");rc="/."+columnName+" is `/g";matchers3=tableSql.match(rc);
for(var i=0,max=matchers3.length;i<max;i++){columnCommentTmp=matchers3[i];fieldComment=tableSql.substring(tableSql.indexOf(columnCommentTmp)+columnCommentTmp.length,tableSql.length).trim();fieldComment=fieldComment.substring(0,fieldComment.indexOf("`")).trim()}}else{if(columnLine.includes(" comment")){commentTmp=columnLine.substring(columnLine.lastIndexOf("comment")+7,columnLine.length).trim();if(commentTmp.includes("`")||commentTmp.indexOf("`")!=commentTmp.lastIndexOf("`")){commentTmp=commentTmp.substring(commentTmp.indexOf("`")+1,commentTmp.lastIndexOf("`"))}if(commentTmp.includes(")")){commentTmp=commentTmp.substring(0,commentTmp.lastIndexOf(")")+1)}fieldComment=commentTmp}}fieldInfo={"columnName":columnName,"fieldName":fieldName,"FieldName":firstUpper(fieldName),"fieldClass":fieldClass,"fieldComment":fieldComment};fieldList.push(fieldInfo)}if(fieldList.length<1){alert("错误")}}var primaryFieldInfo=null;var primaryField=null;var primaryFieldClass=null;for(var i=0,max=fieldList.length;i<max;i++){if(fieldList[i]["columnName"]==primary_column){primaryFieldInfo=fieldList[i];primaryField=primaryFieldInfo["fieldName"];primaryFieldClass=primaryFieldInfo["fieldClass"]}}codeJavaInfo={"tableName":tableName,"className":className,"entityName":className+"Entity","reposityName":className+"Reposity","classComment":classComment,"primary_column":primary_column,"primaryFieldName":firstUpper(primaryField),"primaryField":primaryField,"primaryFieldClass":primaryFieldClass,"fieldList":fieldList,"has_date":has_date};return codeJavaInfo}GetClassInfo=function(tableSql,authorInfo){classInfo=genClassInfo(tableSql);classInfo["primaryfield"]=classInfo["primaryField"].toLowerCase();classInfo["author"]=authorInfo["name"]+"  email: "+authorInfo["email"];classInfo["packageBasename"]=authorInfo["packageBasename"];classInfo["createdate"]=now_chnstr();return classInfo};
